@{
    ViewData["Title"] = "Home Page";
}

<style>
    .draggable {
        cursor: move;
    }
</style>

<svg id="svgparent" viewBox="0 0 800 800" style="background-color:antiquewhite"></svg>
<script src="https://d3js.org/d3.v5.min.js"></script>

<script type="text/javascript">
    var Kodiak = {
        Name: "Kodiak 10/20",
        Boxes: "000000\n000000\n000000\n0L00R0\nLLMCRR\n.MMCC."
    }
    var Drakhun = {
        Name: "MoW Drakhun 10/18(16)",
        Boxes: "00000000000\n.....000000"
    }
    var ShockTroopers = {
        Name: "MoW Shocktroopers+UA 10/17",
        Boxes: "100000000\n200000000\n300000000\n400000000\n500000000\n*00000000"
    }

    var models = [Kodiak, Drakhun, ShockTroopers];
    var selectedElement, offset;

    models.forEach(GenerateSVG);


    /*

    function startDrag(evt) {
        console.log('entered: "' + evt.target.id + '"');
        var target = evt.target;
        //while (target.id == "")
        //    target = target.;
        if (evt.target.classList.contains('draggable')) {
            selectedElement = evt.target;
            offset = getMousePosition(evt);
            offset.x -= parseFloat(selectedElement.getAttributeNS(null, "x"));
            offset.y -= parseFloat(selectedElement.getAttributeNS(null, "y"));
        }
    }
    function drag(evt) {
        if (selectedElement) {
            evt.preventDefault();
            var coord = getMousePosition(evt);
            selectedElement.setAttributeNS(null, "x", coord.x - offset.x);
            selectedElement.setAttributeNS(null, "y", coord.y - offset.y);
        }
    }
    function endDrag(evt) {
        selectedElement = null;
    }
    function getMousePosition(evt) {
        var CTM = evt.target.getScreenCTM();
        return {
            x: (evt.clientX - CTM.e) / CTM.a,
            y: (evt.clientY - CTM.f) / CTM.d
        };
    }

*/

    

    var drag = d3.behavior.drag()
        .on("drag", function (d, i) {
            d.x += d3.event.dx
            d.y += d3.event.dy
            d3.select(this).attr("transform", function (d, i) {
                return "translate(" + [d.x, d.y] + ")"
            })
        });


    function GenerateSVG(value) {
        var svgParent = document.getElementById("svgparent");

        //var svg = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        //svg.id = 'svg' + value.Name.replace(/\s/g, '');
        //svg.classList.add('draggable');
        //svg.setAttribute('pointer-events', 'all');
        //svg.call
        //svgParent.appendChild(svg);

        var svg = d3.select("#svgparent");
        svg.append("svg:g")
            //.data([data.sort(d3.descending)])
            //.data([data])
            .data([{ "x": 0, "y": 0 }])
            .attr("transform", "translate(" + 0 + "," + 0 + ")")
            .call(drag);


        //svg.addEventListener('mousedown', startDrag);
        //svg.addEventListener('mousemove', drag);
        //svg.addEventListener('mouseup', endDrag);
        //svg.addEventListener('mouseleave', endDrag);
        console.log(svg.id);

        var lines = value.Boxes.split('\n');
        var LongestLine = 0
        lines.forEach(function (current_value) {
            if (current_value.length > LongestLine)
                LongestLine = current_value.length;
        });

        var border = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        border.setAttributeNS(null, 'x', 2);
        border.setAttributeNS(null, 'y', 9);
        border.setAttributeNS(null, 'width', LongestLine * 23 + 3);
        border.setAttributeNS(null, 'height', lines.length * 23 + 7);
        border.setAttributeNS(null, 'rx', 3);
        border.setAttributeNS(null, 'ry', 3);
        border.setAttributeNS(null, 'stroke', 'black');
        border.setAttributeNS(null, 'fill', 'white');
        border.setAttributeNS(null, 'pointer-events', 'none');
        svg.appendChild(border);


        var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('y', '11');
        text.setAttribute('fill', 'black');
        text.textContent = value.Name;
        text.setAttribute('pointer-events', 'none');
        svg.appendChild(text);
        var textwidth = text.getComputedTextLength();
        text.setAttribute('x', (5 + LongestLine * 23 + 5 - textwidth) / 2);


        var boarderbreak = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        boarderbreak.setAttributeNS(null, 'x', (5 + LongestLine * 23 + 5 - textwidth) / 2 - 3);
        boarderbreak.setAttributeNS(null, 'y', 8);
        boarderbreak.setAttributeNS(null, 'width', textwidth + 6);
        boarderbreak.setAttributeNS(null, 'height', 3);
        boarderbreak.setAttributeNS(null, 'stroke', 'white');
        boarderbreak.setAttributeNS(null, 'fill', 'white');
        boarderbreak.setAttributeNS(null, 'pointer-events', 'none');
        svg.insertBefore(boarderbreak, text);


        var area = svg.getBBox()

        //var plate = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        //plate.id = 'plate' + value.Name.replace(/\s/g, '');
        //plate.classList.add('draggable');
        //plate.setAttribute('pointer-events', 'all');
        //plate.setAttributeNS(null, 'x', 0);
        //plate.setAttributeNS(null, 'y', 0);
        //plate.setAttributeNS(null, 'width', area.width);
        //plate.setAttributeNS(null, 'height', area.height);
        //plate.setAttributeNS(null, 'fill', 'purple');
        //svg.insertBefore(plate,border);

        //var plateid = '#' + plate.id;

        //var drag = d3.behavior.drag().on("drag", function (d) {
        //    d.x += d3.event.dx;
        //    d.y += d3.event.dy;
        //    d3.select(this.parentNode).select("g").attr("transform", "translate(" + d.x + "," + d.y + ")");
        //    var self = this;
        //    d3.select("#overPath").attr("d", function (_d) {
        //        if (self.id === "plate1") {
        //            _d.x1 += d3.event.dx;
        //            _d.y1 += d3.event.dy;
        //        } else {
        //            _d.x2 += d3.event.dx;
        //            _d.y2 += d3.event.dy;
        //        }
        //        return "M" + _d.x1 + "," + _d.y1 + "L" + _d.x2 + "," + _d.y2;
        //    });
        //});

        //d3.selectAll(plateid).call(drag);

        console.log(value.Name + " (" + area.x + "," + area.y + ") " + area.width + "x" + area.height)


        var InitialXOffset = 5;
        var currentXOffset = 5;
        var currentYOffset = 16;

        for (var i = 0; i < value.Boxes.length; i++) {
            switch (value.Boxes.charAt(i)) {
                case '0':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    currentXOffset += 23;
                    break;
                case 'L':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'L'));
                    currentXOffset += 23;
                    break;
                case 'R':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'R'));
                    currentXOffset += 23;
                    break;
                case 'M':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'M'));
                    currentXOffset += 23;
                    break;
                case 'C':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'C'));
                    currentXOffset += 23;
                    break;
                case 'H':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'H'));
                    currentXOffset += 23;
                    break;
                case 'A':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'A'));
                    currentXOffset += 23;
                    break;
                case 'S':
                    svg.appendChild(CreateSquare(plate, currentXOffset, currentYOffset));
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'S'));
                    currentXOffset += 23;
                    break;
                case '1':
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'A'));
                    currentXOffset += 23;
                    break;
                case '2':
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'B'));
                    currentXOffset += 23;
                    break;
                case '3':
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'C'));
                    currentXOffset += 23;
                    break;
                case '4':
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'D'));
                    currentXOffset += 23;
                    break;
                case '5':
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'E'));
                    currentXOffset += 23;
                    break;
                case '6':
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, 'F'));
                    currentXOffset += 23;
                    break;
                case '*':
                    svg.appendChild(AddLetter(plate, currentXOffset, currentYOffset, '*'));
                    currentXOffset += 23;
                    break;
                case '.':
                    currentXOffset += 23;
                    break;
                case '>':
                    currentXOffset += 12.5;
                    break;
                case '\n':
                    currentYOffset += 23;
                    currentXOffset = InitialXOffset;
                    break;

            }
        }
    }

    function CreateSquare(plate, currentXOffset, currentYOffset) {
        var square = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        square.setAttributeNS(null, 'x', currentXOffset);
        square.setAttributeNS(null, 'y', currentYOffset);
        square.setAttributeNS(null, 'width', 20);
        square.setAttributeNS(null, 'height', 20);
        square.setAttributeNS(null, 'rx', 3);
        square.setAttributeNS(null, 'ry', 3);
        square.setAttributeNS(null, 'stroke', 'black');
        square.setAttributeNS(null, 'fill', 'white');
        square.setAttributeNS(null, 'pointer-events', 'none');
        return square;
    }

    function AddLetter(plate, currentXOffset, currentYOffset, Letter) {
        var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', currentXOffset + 5);
        text.setAttribute('y', currentYOffset + 14);
        text.setAttribute('fill', 'black');
        text.textContent = Letter;
        text.setAttribute('pointer-events', 'none');
        return text;
    }

</script>



